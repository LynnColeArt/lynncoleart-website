---
pagination:
  data: collections
  size: 1
  alias: tag
  filter:
    - all
    - posts
    - tagList
    - galleries
  addAllPagesToCollections: true
layout: base.njk
eleventyComputed:
  title: "Tagged '{{ tag }}'"
permalink: /tags/{{ tag | slug }}/
---

<h1>Tagged "{{ tag }}"</h1>

<div class="timeline">
  {# Collect posts with this tag #}
  {%- set taggedPosts = collections[tag] | default([]) -%}
  
  {# Collect galleries with this tag #}
  {%- set taggedGalleries = [] -%}
  {%- for gallery in galleries -%}
    {%- if gallery.tags and tag in gallery.tags -%}
      {%- set galleryItem = {
        date: gallery.date,
        url: '/gallery/' + gallery.number + '/',
        data: {
          title: gallery.title,
          description: gallery.description,
          tags: gallery.tags,
          type: 'gallery',
          imageCount: gallery.imageCount,
          firstImage: gallery.firstImage
        }
      } -%}
      {%- set taggedGalleries = (taggedGalleries.push(galleryItem), taggedGalleries) -%}
    {%- endif -%}
  {%- endfor -%}
  
  {# Combine and sort all items #}
  {%- set allTaggedItems = taggedPosts | concat(taggedGalleries) | sort(true, false, 'date') | reverse -%}
  
  {%- for item in allTaggedItems -%}
  {%- if not item.data.draft -%}
  <article class="timeline-item{%- if item.data.type == 'gallery' %} timeline-gallery{%- endif -%}">
    {%- if item.data.type == 'gallery' and item.data.firstImage -%}
    <div class="timeline-gallery-bg" style="background-image: url('{{ item.data.firstImage }}');"></div>
    <div class="timeline-gallery-content">
    {%- endif -%}
    
    <time class="timeline-meta" datetime="{{ item.date | htmlDateString }}">
      {{ item.date | dateDisplay }}
      {%- if item.data.type == 'gallery' %} · Gallery{%- else %} · Post{%- endif -%}
    </time>
    
    <h2 class="timeline-title">
      <a href="{{ item.url }}">{{ item.data.title }}</a>
    </h2>
    
    {%- if item.data.type == 'gallery' -%}
    <p class="timeline-excerpt">{{ item.data.imageCount }} image{%- if item.data.imageCount != 1 -%}s{%- endif -%}{%- if item.data.description %} · {{ item.data.description }}{%- endif -%}</p>
    {%- elif item.data.excerpt -%}
    <p class="timeline-excerpt">{{ item.data.excerpt }}</p>
    {%- elif item.data.description -%}
    <p class="timeline-excerpt">{{ item.data.description }}</p>
    {%- endif -%}
    
    {%- if item.data.tags and item.data.tags.length > 0 -%}
    <div class="timeline-tags">
      {%- for t in item.data.tags -%}
      <a href="/tags/{{ t | slug }}/" class="tag{%- if t == tag %} active{%- endif -%}">#{{ t }}</a>
      {%- endfor -%}
    </div>
    {%- endif -%}
    
    {%- if item.data.type == 'gallery' and item.data.firstImage -%}
    </div>
    {%- endif -%}
  </article>
  {%- endif -%}
  {%- endfor -%}
</div>

<p><a href="/">← Back to timeline</a></p>